---
title: å®ç°DeepReadonly
---

# {{ $frontmatter.title }}

## ğŸ¯ é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªé€šç”¨çš„`DeepReadonly<T>`ï¼Œå®ƒå°†å¯¹è±¡çš„æ¯ä¸ªå‚æ•°åŠå…¶å­å¯¹è±¡é€’å½’åœ°è®¾ä¸ºåªè¯»ã€‚

æ‚¨å¯ä»¥å‡è®¾åœ¨æ­¤æŒ‘æˆ˜ä¸­æˆ‘ä»¬ä»…å¤„ç†å¯¹è±¡ã€‚æ•°ç»„ï¼Œå‡½æ•°ï¼Œç±»ç­‰éƒ½æ— éœ€è€ƒè™‘ã€‚ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡è¦†ç›–å°½å¯èƒ½å¤šçš„ä¸åŒæ¡ˆä¾‹æ¥æŒ‘æˆ˜è‡ªå·±ã€‚

ä¾‹å¦‚

```ts
type X = {
  x: {
    a: 1;
    b: 'hi';
  };
  y: 'hey';
};

type Expected = {
  readonly x: {
    readonly a: 1;
    readonly b: 'hi';
  };
  readonly y: 'hey';
};

type Todo = DeepReadonly<X>; // should be same as `Expected`
```

## ğŸ” åˆ†æ

```ts
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends {} ? DeepReadonly<T[P]> : T[P];
};
```

é€šè¿‡ `T[P] extends {} ? DeepReadonly<T[P]> : T[P]` å¯¹å±æ€§å€¼è¿›è¡ŒäºŒæ¬¡åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ç»§æ‰¿è‡ª å¯¹è±¡ï¼Œé‚£ä¹ˆå°±é€’å½’å¤„ç†ï¼Œå¦åˆ™è¿”å›åŸå§‹å±æ€§å€¼ã€‚

ç†è®ºä¸Šè¿™æ ·å°±èƒ½å¤Ÿç»“æŸæœ¬é¢˜ç›®ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ä¸¤ä¸ªç‰¹æ®Šåœºæ™¯ï¼Œå…ƒç»„å’Œå‡½æ•°ï¼Œéƒ½ç»§æ‰¿è‡ªå¯¹è±¡ `{}`ã€‚

```ts
type Case1 = [] extends {} ? true : false; // true
type Case2 = (() => {}) extends {} ? true : false; // true
```

å¯¹äºå…ƒç»„ï¼Œä¹‹å‰å…¶å®ä¹Ÿæ¯”è¾ƒéšæ™¦çš„æåˆ°è¿‡ï¼Œå…ƒç»„çš„éå†ï¼Œå¯ä»¥é€šè¿‡å’Œå¯¹è±¡ä¸€æ‘¸ä¸€æ ·çš„éå†æ‰‹æ®µè¿›è¡Œï¼š

```ts
type Traverse<T> = {
  [P in keyof T]: T[P];
};

type Case3 = Traverse<[1, 2, 3]>; // [1, 2, 3]
```

å…ƒç»„çš„éå†å°±æ˜¯è¿™æ ·ï¼ŒåŒå¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥å¢åŠ  `readonly` ç­‰ä¿®é¥°ç¬¦ã€‚æ•…è¿™ä¸€åœºæ™¯å¯ä»¥å¿½ç•¥ã€‚

ä½†æ˜¯å¯¹äºå‡½æ•°æ¥è®²ï¼Œå°±å‡ºç°äº†é”™è¯¯ï¼š

```ts
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends {} ? DeepReadonly<T[P]> : T[P];
};

// Case4 = {}
type Case4 = DeepReadonly<() => {}>;

// Case5 = never
type Case5 = keyof (() => {});
```

å¯¹äºå‡½æ•°æ‰§è¡Œéå†ï¼Œé‚£ä¹ˆç”±äº `keyof (() => {})` æ˜¯ `never`ï¼Œæ–°çš„ç±»å‹çš„å±æ€§å°±ä¸ºç©ºï¼Œä»è€Œè¿”å› `{}`ã€‚

æ‰€ä»¥å¯¹äºæ­¤é¢˜ï¼Œåªéœ€è¦å¢åŠ å‡½æ•°çš„é¢å¤–å¤„ç†å³å¯ã€‚

## ğŸ› ï¸ é¢˜è§£

```ts
type DeepReadonly<T> = {
  readonly [P in keyof T]: T[P] extends Function
    ? T[P]
    : T[P] extends {}
    ? DeepReadonly<T[P]>
    : T[P];
};
```

å¢åŠ å‡½æ•°çš„åœºæ™¯åˆ¤æ–­å³å¯ã€‚

## ğŸ’¡ çŸ¥è¯†ç‚¹

1. é€’å½’å¤„ç†åµŒå¥—é—®é¢˜
2. å…ƒç»„å¯ä»¥ä½¿ç”¨éå†å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œéå†
3. `(() => {}) extends {}` ç»“æœä¸º true